--
-- Database
--

CREATE ROLE "DevicesUser" WITH LOGIN ENCRYPTED PASSWORD $$DevicesUserPassword$$;
CREATE DATABASE "Devices.Data";
ALTER DATABASE "Devices.Data" OWNER TO "DevicesUser";

--
-- Schemas
--

CREATE SCHEMA "Garden";

--
-- Tables
--

CREATE TABLE "Application" (
	"ApplicationID" int NOT NULL,
	"ApplicationName" varchar(1024) NOT NULL,
	"ApplicationActive" bool NOT NULL,
	CONSTRAINT "PK_Application" PRIMARY KEY ("ApplicationID"),
	CONSTRAINT "IX_Application_ApplicationName" UNIQUE ("ApplicationName")
);

CREATE TABLE "Action" (
	"ActionID" int NOT NULL,
	"ActionType" int NOT NULL,
	"ActionParameters" varchar(1024) NOT NULL,
	CONSTRAINT "PK_Action" PRIMARY KEY ("ActionID")
);

CREATE TABLE "Release" (
	"ReleaseID" int NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	"Date" timestamp with time zone NOT NULL,
	"ApplicationID" int NOT NULL,
	"Package" varchar(1024) NOT NULL,
	"Version" varchar(64) NOT NULL,
	"ActionID" int NOT NULL,
	"ReleaseActive" bool NOT NULL,
	CONSTRAINT "PK_Release" PRIMARY KEY ("ReleaseID"),
	CONSTRAINT "FK_Release_Application" FOREIGN KEY ("ApplicationID") REFERENCES "Application" ("ApplicationID"),
	CONSTRAINT "FK_Release_Action" FOREIGN KEY ("ActionID") REFERENCES "Action" ("ActionID")
);

CREATE TABLE "Device" (
	"DeviceID" varchar(64) NOT NULL,
	"DeviceName" varchar(1024) NOT NULL,
	"DeviceActive" bool NOT NULL,
	CONSTRAINT "PK_Device" PRIMARY KEY ("DeviceID"),
	CONSTRAINT "IX_Device_DeviceName" UNIQUE ("DeviceName")
);

CREATE TABLE "DeviceFingerprint" (
	"FingerprintType" int NOT NULL,
	"FingerprintValue" varchar(1024) NOT NULL,
	"DeviceID" varchar(64) NOT NULL,
	CONSTRAINT "PK_DeviceFingerprint" PRIMARY KEY ("FingerprintType", "FingerprintValue"),
	CONSTRAINT "FK_DeviceFingerprint_Device" FOREIGN KEY ("DeviceID") REFERENCES "Device" ("DeviceID")
);

CREATE TABLE "DeviceMetric" (
	"DeviceID" varchar(64) NOT NULL,
	"Date" timestamp with time zone NOT NULL,
	"LastReboot" timestamp with time zone NOT NULL,
	"CpuUser" real NOT NULL,
	"CpuSystem" real NOT NULL,
	"CpuIdle" real NOT NULL,
	"MemoryTotal" int NOT NULL,
	"MemoryUsed" int NOT NULL,
	"MemoryFree" int NOT NULL,
	CONSTRAINT "PK_DeviceMetric" PRIMARY KEY ("DeviceID", "Date"),
	CONSTRAINT "FK_DeviceMetric_Device" FOREIGN KEY ("DeviceID") REFERENCES "Device" ("DeviceID")
);

CREATE TABLE "Garden"."WeatherCondition" (
	"Date" timestamp with time zone NOT NULL,
	"Temperature" numeric NOT NULL,
	"Humidity" numeric NOT NULL,
	"Pressure" numeric NOT NULL,
	"Illuminance" numeric NOT NULL,
	CONSTRAINT "PK_WeatherCondition" PRIMARY KEY ("Date")
);